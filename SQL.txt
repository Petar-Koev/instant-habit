USE [master];
GO

IF DATABASEPROPERTYEX ('InstantHabit', 'Version' ) IS NOT NULL
BEGIN 
    -- It cancels all runing transactions and closes open connections
	ALTER Database [InstantHabit] SET SINGLE_USER
	WITH ROLLBACK IMMEDIATE;
	DROP DATABASE [InstantHabit];
END
GO

CREATE DATABASE [InstantHabit];
GO

-- This gives a simple backup that can be used to replace the entire db in the event of failure.
ALTER DATABASE [InstantHabit] SET RECOVERY SIMPLE;
GO

USE [InstantHabit];
GO

CREATE SCHEMA [InstantHabit];
GO

CREATE TABLE [InstantHabit].[Habits] (
    [Id] int identity(1,1) NOT NULL,
	[Name] nvarchar(500) NOT NULL,
	[CreationDate] datetime NOT NULL DEFAULT GETDATE(),
	[Description] nvarchar(500) NULL

	CONSTRAINT [PK_Habits] PRIMARY KEY ([Id])
);
GO

INSERT INTO [InstantHabit].[Habits] (Name, Description)
VALUES
     ('WorkingOut','Daily Excercise Routine'),
	 ('Swimming', NULL ),
	 ('Sleep', 'Try to sleep 7h+ a day'),
	 ('Music','Practice arpeggios and Pentatonic Scales');
GO

CREATE TABLE [InstantHabit].[Days] (
    [Id] int identity(1,1) NOT NULL,
	[HabitId] int NOT NULL,
	[DayNumber] int NOT NULL, 
	[Note] nvarchar(500) NULL,
	[IsChecked] bit NOT NULL Default 0

	CONSTRAINT [PK_Days] PRIMARY KEY ([Id])
	CONSTRAINT [FK_HabitId] FOREIGN KEY ([HabitId])  
	REFERENCES [InstantHabit].[Habits] ([Id]) 
	ON DELETE CASCADE -- It allows you to delete rows when 2 tables are dependent
);
GO

INSERT INTO [InstantHabit].[Days] (HabitId, DayNumber, Note, IsChecked)
VALUES
     (1,3,'My muscles hurt a lot, damn',1),
	 (2,4,'I almost drowned today',1 ),
	 (3,2,NULL,0),
	 (4,5,'A7X - Afterlife Solo[Done]',1);
GO

-- Declare Stored Procedures
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- Create New List Stored Procedure
CREATE OR ALTER PROCEDURE [Packd].[CreateNewList_StoredProcedure]
@Name varchar(500)
AS
BEGIN
	INSERT INTO Packd.Lists (Name, CreationDate) VALUES (@Name, GETDATE())
END
GO